<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sector Pie Chart</title>
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="bg-light py-3">
      <div class="container d-flex align-items-center">
        <a href="../index.html">
          <img
            src="../Images/logo.jpg"
            alt="Logo"
            class="mr-3"
            style="width: 50px"
          />
        </a>
        <a class="nav-link" href="../VariousGraph/PriceVsPlayer.html"
          >Price Vs Player</a
        >
        <a class="nav-link" href="../VariousGraph/heatmap.html">Heatmap</a>
        <a class="nav-link" href="../VariousGraph/wordcloud.html">WordCloud</a>
        <a class="nav-link" href="../VariousGraph/sector_chart.html"
          >Genres Freq PlayTime</a
        >
      </div>
    </header>
    <h3>Genres with their frequency and average playtime</h3>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
      // Load and preprocess data
      d3.csv("../Data/steam.csv").then(function (data) {
        // Flatten the data so each genre is treated individually
        let flattenedData = flattenGenres(data);

        // Process your data to calculate frequency and median playtime for each genre
        let processedData = processData(flattenedData);

        // Rest of the pie chart code as before...
        let pie = d3.pie().value(function (d) {
          return d.frequency;
        })(processedData);

        let arc = d3
          .arc()
          .innerRadius(0)
          .outerRadius(function (d) {
            return scaleRadius(d.data.meanPlaytime);
          });

        let scaleRadius = d3
          .scaleLinear()
          .domain([0, d3.max(processedData, (d) => d.meanPlaytime)])
          .range([200, 500]);

        let svg = d3
          .select("body")
          .append("svg")
          .attr("width", 1920)
          .attr("height", 1080)
          .append("g")
          .attr("transform", "translate(750,500)");

        let totalFrequency = d3.sum(processedData, (d) => d.frequency);
        let tooltip = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("position", "absolute")
          .style("background", "#fff")
          .style("padding", "5px")
          .style("border", "1px solid #ccc")
          .style("border-radius", "5px")
          .style("visibility", "hidden")
          .text("Tooltip");

        let customColors = [
          "#1f77b4",
          "#aec7e8",
          "#ff7f0e",
          "#ffbb78",
          "#2ca02c",
          "#98df8a",
          "#d62728",
          "#ff9896",
          "#9467bd",
          "#c5b0d5",
          "#8c564b",
          "#c49c94",
          "#e377c2",
          "#f7b6d2",
          "#7f7f7f",
          "#c7c7c7",
          "#bcbd22",
          "#dbdb8d",
          "#17becf",
          "#9edae5",
        ];

        let colorScale = d3.scaleOrdinal(customColors);
        svg
          .selectAll("path")
          .data(pie)
          .enter()
          .append("path")
          .attr("d", arc)
          .attr("fill", function (d, i) {
            return colorScale(i);
          })
          .on("mouseover", function (e, d) {
            let percentage = (
              (d.data.frequency / totalFrequency) *
              100
            ).toFixed(2);
            tooltip
              .style("visibility", "visible")
              .text(
                `${d.data.genre}: ${d.data.meanPlaytime} hrs (${percentage}%)`
              );
          })
          .on("mousemove", function (e) {
            tooltip
              .style("top", e.pageY - 10 + "px")
              .style("left", e.pageX + 10 + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });

        let legend = svg
          .append("g")
          .attr("class", "legend")
          .selectAll("g")
          .data(processedData)
          .enter()
          .append("g")
          .attr("transform", function (d, i) {
            return `translate(300, ${i * 20 - 300})`;
          });

        legend
          .append("rect")
          .attr("width", 18)
          .attr("height", 18)
          .attr("fill", function (d, i) {
            return d3.schemeCategory10[i % 10];
          });

        legend
          .append("text")
          .attr("x", 18)
          .attr("y", 9)
          .attr("dy", ".3em")
          .text(function (d) {
            return d.genre;
          });
      });

      // Flatten genres into individual records
      function flattenGenres(data) {
        let flattened = [];
        data.forEach((d) => {
          let genres = d.genres.split(";");
          genres.forEach((genre) => {
            flattened.push({
              genres: genre.trim(),
              average_playtime: +d.average_playtime,
            });
          });
        });
        return flattened;
      }

      // Process flattened data to calculate frequency and median playtime
      function processData(data) {
        let genres = d3.group(data, (d) => d.genres);
        let processedData = [];

        genres.forEach((value, key) => {
          let meanPlaytime = d3.mean(value, (d) => d.average_playtime);
          processedData.push({
            genre: key,
            meanPlaytime: meanPlaytime,
            frequency: value.length,
          });
        });

        return processedData;
      }
    </script>
    <footer class="footer bg-dark text-light py-3 mt-auto">
      <div class="container text-center">
        <div class="row">
          <div class="col">
            <p class="text-white mt-3">
              Made with <span style="color: #ffffff">&hearts;</span> By Harsh &
              Divyansh & Ishan
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <a
              href="https://www.linkedin.com/in/harsh-gupta-4ba4a7254/"
              class="text-white mr-4"
              ><i class="fab fa-linkedin"></i> Harsh</a
            >
            <a href="https://github.com/harsh-gupta10" class="text-white mr-4"
              ><i class="fab fa-github"></i> Harsh</a
            >
            <a
              href="https://www.linkedin.com/in/divyansh"
              class="text-white mr-4"
              ><i class="fab fa-linkedin"></i> Divyansh</a
            >
            <a href="https://github.com/divyansh" class="text-white mr-4"
              ><i class="fab fa-github"></i> Divyansh</a
            >
            <a href="https://www.linkedin.com/in/ishan" class="text-white mr-4"
              ><i class="fab fa-linkedin"></i> Ishan</a
            >
            <!-- GitHub links -->

            <a href="https://github.com/ishan" class="text-white"
              ><i class="fab fa-github"></i> Ishan</a
            >
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
